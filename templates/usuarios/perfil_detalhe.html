{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-body d-flex align-items-center">
          <div class="me-4">
            {% if perfil.foto %}
            <img src="{{ perfil.foto.url }}" alt="Avatar" class="rounded-circle" style="width:96px;height:96px;object-fit:cover;">
            {% else %}
            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width:96px;height:96px;">
              <i class="fas fa-user fa-2x text-white"></i>
            </div>
            {% endif %}
          </div>
          <div class="flex-grow-1">
            <h3 class="mb-0">{{ usuario.get_full_name|default:usuario.username }}</h3>
            <p class="text-muted mb-1">{{ usuario.email }}</p>
            <p class="mb-0"><strong>Tipo de Perfil:</strong> {{ perfil.get_tipo_display }}</p>
            {% if perfil.grupos_permissao.exists %}
            <p class="mb-0"><strong>Grupos:</strong> {% for g in perfil.grupos_permissao.all %} <span class="badge bg-secondary">{{ g.nome }}</span>{% endfor %}</p>
            {% endif %}
          </div>
          <div>
            {% if usuario == request.user %}
              <a href="{% url 'usuarios:editar_usuario' usuario.id %}" class="btn btn-outline-primary">Editar</a>
            {% endif %}
          </div>
        </div>
      </div>

      {% if usuario == request.user %}
      <div class="card mt-3">
        <div class="card-header">Foto de Perfil</div>
        <div class="card-body">
          <form method="post" enctype="multipart/form-data" action="{% url 'usuarios:perfil_detalhe' %}">
            {% csrf_token %}
            <div class="mb-3">
              <label for="foto" class="form-label">Escolher imagem</label>
              <input class="form-control" type="file" id="foto" name="foto" accept="image/*">
            </div>
            <button class="btn btn-primary" type="submit">Enviar</button>
          </form>
        </div>
      </div>
      {% endif %}

      <div class="card mt-3">
        <div class="card-header">
          Detalhes
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-sm-4">Nome de usuário</dt>
            <dd class="col-sm-8">{{ usuario.username }}</dd>

            <dt class="col-sm-4">Nome completo</dt>
            <dd class="col-sm-8">{{ usuario.get_full_name|default:'-' }}</dd>

            <dt class="col-sm-4">Email</dt>
            <dd class="col-sm-8">{{ usuario.email|default:'-' }}</dd>

            <dt class="col-sm-4">Data de criação</dt>
            <dd class="col-sm-8">{{ usuario.date_joined }}</dd>

            <dt class="col-sm-4">Último login</dt>
            <dd class="col-sm-8">{{ usuario.last_login|default:'-' }}</dd>
          </dl>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
